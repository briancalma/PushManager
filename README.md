# PushPanda Notification Plugin
PushPanda is a  CakePHP 2.x Plugin that is intended to give an easy way of sending push messages to your FCM Server(Firebase Cloud Messaging). 
It sends push notification configured messages to your FCM server using CURL and allow clean flow with a minimal need of installation, with just few minutes you can see your Push Notification up running. 

## Getting Started
These instructions will get you a copy of the project up and running on your local machine for development and testing purposes. See deployment for notes on how to deploy the project on a live system.

### Prerequisites
1. Be sure that you have an FCM (Firebase Cloud Messaging App), If you dont have go to : https://console.firebase.google.com/
2. Install CURL https://curl.haxx.se/
3. Clone or download this project :).
4. CakePHP 2.x App 
5. Dont forget to setup and install your service worker.  

### Installing
1. Extract the zip version of this project. 
2. Put it on your app/Plugin folder.


### Enabling the plugin
1. Go to your app/Config/bootstrap.php and paste this line: 
    
    CakePlugin::load('PushManager', array('bootstrap' => false, 'routes' => false));

2. Next go to your AppController.php and add this as component. Your code will look something like this.
    
    public $components = [
                            '... ',
                            '.....',
                            'PushManager.Push',
                            'Session'
                          ];
                          
    Take note that if your are not using the Session component you are required to put it in your components array.
    
#### Optional
    2.1 If you are using an auth component to authenticate login behaviors you must go to this directory   
     app/Plugin/PushManager/Controller/PushComponent.php open it up.

    2.2 Uncomment this line of code : # $this->Auth->allow('index','login','dashboard','logout');

3. Now you can go to this url : https://sitename/push_manager/push_panda/login

4. A login form will show asking for your username and password:
   username : admin
   password : admin

5. After logging in you are redirect to the dashboard and another form will show asking for your FCM server key. 

6. Fill up the field and submit take note that the server key is a string created by FCM. Go to your FCM console for more details. 

7. After fillingup the field a message will show that "You successfully installed PushPanda Notification Plugin"
   - if for some reasons an error occured during this phase please make sure that your apache server and your app/webroot/files folder are writable. 

8. You can then logout. Congrats you successfully installed the plugin!

Now you can use PushPanda Notification plugin in any controller in your application.

### Using the Plugin
To use the plugin be sure that you installed your service worker and needed javascript files in your application. It is worth noting that this plugin sends a DATA Payload message thus this means that you must configure your service worker to handle that type of messages. Wait for the other versions of this plugin for i might include the service worker and scripts generation 🐼.

For you to create a Push Message you must call the send($token_list[],$data[]) function of the Push Component. 
The send() function gets an array as a first parameter and also another array for the second one.
- The first array will hold all the token of your possible recievers. Take note that the token is generated by FCM itself whenever your client grants permission for a notification.
- The second array holds the data that defines the configuration of your message. 
- Here is the following configurations that you can play with:
  * title - is a string that specifies the title of your push notif.
  * body  - is a string that specifies the body of your push notif.
  * icon  - is a string that specifies the location of your icon in your push notif 
  * image - is a string that specifies the location of your image of your push notif. Take note that as of now this is only applicable to chrome browsers.
  * click_action - is a string that holds the redirection url when the user click the notification.


#### Below is an example on how to use the plugin 

Example :

      public function sendNotif()
      {
           $token_list = ["dWU9cirOa_0:APA91bHGTlVnd42890A8QGWd1LT6jhqskSt4ycTQe7DZ3TsQTj3gx1jWXWjXxac2UhSvaaeeJulygfLTiO8_V_7-d6jmI0zslnD9IT9aBxTyhWW6RTKnRJroShG2T_uczEFJaK-EOjel"];
           
           $data = [
                                "title" => 'Your Awesome Title Here',
            		    "body" => 'Some cool body you want to share to the world!',
            		    "icon" => 'the location of your icon',
            		    "image" => 'the location of your image',
            		    "click_action" => 'when the client click your notification this will redirect to what url?'
   	               ];
            
            $this->Push->send( $token_list, $data );
      }

Output: 

{"multicast_id":6544764715255567500,"success":1,"failure":0,"canonical_ids":0,"results":[{"message_id":"0:1530164660100134%e609af1cf9fd7ecd"}]}

In the next update i will try to configure this plugin so that it can actually process this output information.

## Built With

* [CakePHP] (https://cakephp.org/) - PHP framework used.
* [Firebase Cloud Messaging](https://firebase.google.com/docs/cloud-messaging/) - The one that sends push notifications to the clients

## Authors

* **Brian Calma** - *Initial work* - [PushPanda](https://github.com/briancalma/PushManager)

## Acknowledgments
* Thanks a lot to sir Ado for giving me insights and lectures upon doing this project. 
